{% extends 'base.twig' %}

{#
title
stylesheets
navi
body
javascript
#}


{% block title %}{{config['site-name']}} || Add New Blog Post{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/css/select2.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2-bootstrap-css/1.4.6/select2-bootstrap.min.css">

{% endblock %}

{% block body %}
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">Add New Blog Post</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Add Blog Post
                </div>

                
                <div class="panel-body">
                    <form action="{{ currentRoute }}" method="POST" role="form">
                        <div class="col-md-8">
                            <div class="form-group{% if has_error('title') %} has-error{% endif %}">
                                <label for="title">Title</label>
                                <input type="text" name="title" class="form-control" id="title" placeholder="Title" value="{% if requestParams.title %}{{requestParams.title}}{% endif %}" required="required">
                                <span class="help-block">{{ error('title') }}</span>
                            </div>

                            <div class="form-group{% if has_error('slug') %} has-error{% endif %}">
                                <label for="slug">SEO Slug</label>
                                <input type="text" name="slug" class="form-control" id="slug" placeholder="SEO Slug" value="{% if requestParams.slug %}{{requestParams.slug}}{% endif %}" required="required">
                                <span class="help-block">{{ error('slug') }}</span>
                            </div>

                            <div class="form-group{% if has_error('post_content') %} has-error{% endif %}">
                                <label for="post_content">Content</label>
                                <textarea name="post_content" class="form-control" id="post_content" placeholder="Post Content" required="required">
                                    {% if requestParams.post_content %}{{requestParams.post_content}}{% endif %}
                                </textarea>
                                <span class="help-block">{{ error('post_content') }}</span>
                            </div>

                        </div>
                        
                        <div class="col-md-4">

                            <div class="form-group{% if has_error('category') %} has-error{% endif %}">
                                <label for="category">Category</label>
                                <select name="category" id="category" class="form-control" required="required">
                                    <option value="">Select Category</option>
                                    {% for category in categories %}
                                        <option value="{{ category.id }}" {% if requestParams.category == category.id %}SELECTED{% endif %}>{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                                <span class="help-block">{{ error('category') }}</span>
                            </div>

                            <div class="form-group{% if has_error('tags') %} has-error{% endif %}">
                                <label for="tags">Tags</label>
                                <select data-placeholder="Choose some Tags..." name="tags[]" id="tags" class="form-control" multiple="" tabindex="3">
                                    <option value=""></option>
                                    {% for tag in tags %}
                                        <option value="{{ tag.id }}">{{ tag.name }}</option>
                                    {% endfor %}
                                </select>
                                <span class="help-block">{{ error('tags') }}</span>
                            </div>

                            <div class="form-group{% if has_error('featured_image') %} has-error{% endif %}">
                                <label for="cl_upload">Featured Image (Resized to 1200px by 630px)</label>

                                
                                <div class="progress_percent" style="display: none;">0%</div>
                                <div class="progress_bar" style="background-color: #000; width: 0px; border-radius: 30px; display: none;">&nbsp;</div>
                                <input type="hidden" name="featured_image" id="featured_image" data-token="" value="{{requestParams.featured_image}}" required />
                                <span class="help-block">{{ error('featured_image') }}</span>
                                <div id="featured_preview" style="text-align: center;">
                                    {% if requestParams.featured_image %}

                                    {% endif %}
                                </div>
                            </div>

                            <div class="form-group{% if has_error('video_id') or has_error('video_provider') %} has-error{% endif %}" id="fv_group">
                                <label for="video_id">Featured Video</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="video_url" name="video_url" placeholder="Youtube/Vimeo URL" value="{{requestParams.video_url}}">
                                    <input type="hidden" name="video_provider" id="video_provider" value="{{requestParams.video_provider}}" />
                                    <input type="hidden" name="video_id" id="video_id" value="{{requestParams.video_id}}" />
                                    
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" id="fvButton">
                                            <i class="fa fa-arrow-right"></i>
                                        </button>
                                    </span>
                                </div>
                                <span class="help-block">{{ error('video_id') }}</span>
                                <span class="help-block">{{ error('video_provider') }}</span>

                                <div id="video_preview">
                                    {% if requestParams.video_id and requestParams.video_provider %}
                                        {% if requestParams.video_provider == "youtube" %}
                                            <div class="video-container">
                                                <iframe src="https://www.youtube.com/embed/{{requestParams.video_id}}" frameborder="0" allowfullscreen></iframe>
                                            </div>
                                        {% endif %}

                                        {% if requestParams.video_provider == "vimeo" %}
                                            <div class="video-container">
                                                <iframe src="https://player.vimeo.com/video/{{requestParams.video_id}}" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowfullscreen></iframe>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                                
                            </div>

                        </div>
                        
                        <div class="col-md-4 col-md-offset-4">
                            <div class="form-group">
                                <button type="submit" class="btn btn-success form-control">Save New Blog Post</button>
                            </div>
                        </div>
                        {{ csrf() }}
                        <input type="hidden" name="user_id" value="{{user.id}}" />
                    </form>
                </div>
            </div>
        </div>
    </div>

    <button type="button" class="btn btn-default" id="test-button">button</button>
{% endblock %}

{% block javascript %}
<!-- Select2 Dropdowns -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.5/js/select2.min.js" type="text/javascript"></script>


{#
{{cloudinary_js_config()}}
<script src="/assets/default/js/blog/featured.upload.min.js" type="text/javascript"></script>

<!-- Featured Video -->
<script src="/assets/default/js/jsVideoUrlParser.min.js" type="text/javascript"></script>
<script src="/assets/default/js/blog/featuredvideo.min.js" type="text/javascript"></script>
#}
<script src="https://cdnjs.cloudflare.com/ajax/libs/tinymce/4.7.1/tinymce.min.js"></script>
<script type="text/javascript">

$(document).ready(function() {

    tinymce.init({
        selector: "textarea",
        theme: "modern",
        height: "300", 
        paste_data_images: true,
        plugins: [
          "advlist autolink lists link charmap print preview hr anchor pagebreak image",
          "searchreplace wordcount visualblocks visualchars code fullscreen",
          "insertdatetime media nonbreaking save table contextmenu directionality",
          "emoticons template paste textcolor colorpicker textpattern imagetools"
        ],
        toolbar1: "undo redo | styleselect forecolor backcolor | bold italic | alignleft aligncenter alignright alignjustify | bullist numlist outdent indent | link",
        toolbar2: "image media",
        bootstrapConfig: {
            'imagesPath': '/uploads/' // replace with your images folder path
        },
        branding: false
    });

    $('#tags').select2({
        tags: true
    });
});

$(document).on('click', '#test-button', function(){
    DappurMedia.loadMedia('blog', 'post_content');
});
</script>
{% endblock %}

