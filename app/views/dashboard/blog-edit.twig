{% extends 'admin.twig' %}

{#
title
stylesheets
navi
body
javascript
#}


{% block title %}{{config['site-name']}} || Add New Blog Post{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="/assets/default/css/blog/select2.min.css">
{% endblock %}

{% block body %}
    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">Edit Blog Post</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-primary">
                <div class="panel-heading">
                    Edit Blog Post
                </div>
                
                <div class="panel-body">
                    <form action="{{ currentRoute }}" method="POST" role="form">
                        <div class="col-md-8">
                            <div class="form-group{% if has_error('title') %} has-error{% endif %}">
                                <label for="title">Title</label>
                                <input type="text" name="title" class="form-control" id="title" placeholder="Title" value="{% if requestParams.title %}{{requestParams.title}}{% else %}{{ post[0].title }}{% endif %}" required="required">
                                <span class="help-block">{{ error('title') }}</span>
                            </div>

                            <div class="form-group{% if has_error('slug') %} has-error{% endif %}">
                                <label for="slug">SEO Slug</label>
                                <input type="text" name="slug" class="form-control" id="slug" placeholder="SEO Slug" value="{% if requestParams.slug %}{{requestParams.slug}}{% else %}{{ post[0].slug }}{% endif %}" required="required">
                                <span class="help-block">{{ error('slug') }}</span>
                            </div>

                            <div class="form-group{% if has_error('post_content') %} has-error{% endif %}">
                                <label for="post_content">Post Content</label>
                                <textarea name="post_content" class="form-control" id="post_content" placeholder="Post Content" required="required">
                                    {% if requestParams.post_content %}{{requestParams.post_content}}{% else %}{{ post[0].post_content }}{% endif %}
                                </textarea>
                                <span class="help-block">{{ error('post_content') }}</span>
                            </div>

                        </div>
                        
                        <div class="col-md-4">

                            <div class="form-group{% if has_error('category') %} has-error{% endif %}">
                                <label for="category">Post Category</label>
                                <select name="category" id="category" class="form-control" required="required">
                                    <option value="">Select Category</option>
                                    {% for category in categories %}
                                        <option value="{{ category.id }}" {% if requestParams.category == category.id or post[0].category_id == category.id %}SELECTED{% endif %}>{{ category.name }}</option>
                                    {% endfor %}
                                </select>
                                <span class="help-block">{{ error('category') }}</span>
                            </div>

                            <div class="form-group{% if has_error('tags') %} has-error{% endif %}">
                                <label for="tags">Post Tags</label>
                                <select data-placeholder="Choose some Tags..." name="tags[]" id="tags" class="form-control" multiple="" tabindex="3">
                                    <option value=""></option>
                                    {% for tag in tags %}
                                        <option value="{{ tag.id }}" {% if tag.id in currentTags %}SELECTED{% endif %}>{{ tag.name }}</option>
                                    {% endfor %}
                                </select>
                                <span class="help-block">{{ error('tags') }}</span>
                            </div>

                            <div class="form-group{% if has_error('featured_image') %} has-error{% endif %}">
                                <label for="cl_upload">Featured Image (Resized to 1200px by 630px)</label>

                                <label class="btn btn-block btn-success">
                                    Browse for Featured Imageâ€¦ {{ cl_image_upload_tag('cl_upload', { "folder" : "blog/featured-images", "html" : {"accept" : "image/*", "style" : "margin-bottom: 20px; display: none;", "multiple" : false } }) }}
                                </label>
                                <div class="progress_percent" style="display: none;">0%</div>
                                <div class="progress_bar" style="background-color: #000; width: 0px; border-radius: 30px; display: none;">&nbsp;</div>
                                <input type="hidden" name="featured_image" id="featured_image" value="{% if requestParams.featured_image %}{{requestParams.featured_image}}{% else %}{{ post[0].featured_image }}{% endif %}" required />
                                <span class="help-block">{{ error('featured_image') }}</span>
                                <div id="featured_preview" style="text-align: center;">
                                    {% if post[0].featured_image %}
                                        {{ cl_image_tag(post[0].featured_image, {gravity: "center", height: 210, width: 400, crop: "fill", style: "width: 100%;"}) }}
                                    {% elseif requestParams.featured_image %}
                                        {{ cl_image_tag(requestParams.featured_image, {gravity: "center", height: 210, width: 400, crop: "fill", style: "width: 100%;"}) }}
                                    {% endif %}
                                </div>
                            </div>

                            <div class="form-group{% if has_error('video_id') or has_error('video_provider') %} has-error{% endif %}" id="fv_group">
                                <label for="video_id">Featured Video</label>
                                <div class="input-group">
                                    <input type="text" class="form-control" id="video_url" name="video_url" placeholder="Youtube/Vimeo URL" value="{% if requestParams.video_url %}{{requestParams.video_url}}{% else %}{{ post[0].video_url }}{% endif %}">
                                    <input type="hidden" name="video_provider" id="video_provider" value="{% if requestParams.video_provider %}{{requestParams.video_provider}}{% else %}{{ post[0].video_provider }}{% endif %}" />
                                    <input type="hidden" name="video_id" id="video_id" value="{% if requestParams.video_id %}{{requestParams.video_id}}{% else %}{{ post[0].video_id }}{% endif %}" />
                                    
                                    <span class="input-group-btn">
                                        <button class="btn btn-default" id="fvButton">
                                            <i class="fa fa-arrow-right"></i>
                                        </button>
                                    </span>
                                </div>
                                <span class="help-block">{{ error('video_id') }}</span>
                                <span class="help-block">{{ error('video_provider') }}</span>

                                <div id="video_preview">
                                    {% if post[0].video_provider and post[0].video_id %}
                                        {% if post[0].video_provider == "youtube" %}
                                            <div class="video-container">
                                                <iframe src="https://www.youtube.com/embed/{{post[0].video_id}}" frameborder="0" allowfullscreen></iframe>
                                            </div>
                                        {% endif %}

                                        {% if post[0].video_provider == "vimeo" %}
                                            <div class="video-container">
                                                <iframe src="https://player.vimeo.com/video/{{post[0].video_id}}" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowfullscreen></iframe>
                                            </div>
                                        {% endif %}
                                    {% elseif requestParams.video_id and requestParams.video_provider %}
                                        {% if requestParams.video_provider == "youtube" %}
                                            <div class="video-container">
                                                <iframe src="https://www.youtube.com/embed/{{requestParams.video_id}}" frameborder="0" allowfullscreen></iframe>
                                            </div>
                                        {% endif %}

                                        {% if requestParams.video_provider == "vimeo" %}
                                            <div class="video-container">
                                                <iframe src="https://player.vimeo.com/video/{{requestParams.video_id}}" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowfullscreen></iframe>
                                            </div>
                                        {% endif %}
                                    {% endif %}
                                </div>
                                
                            </div>

                        </div>
                        
                        <div class="col-md-4 col-md-offset-4">
                            <div class="form-group">
                                <button type="submit" class="btn btn-success form-control">Save Blog Post</button>
                            </div>
                        </div>
                        {{ csrf() }}
                        <input type="hidden" name="user_id" value="{{user.id}}" />
                        <input type="hidden" name="post_id" value="{{post[0].id}}" />
                    </form>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javascript %}
<!-- Tiny MCE -->
<script src="/assets/default/js/blog/tinymce/tinymce.min.js"></script>
<script src="/assets/default/js/blog/init-tinymce.min.js" type="text/javascript"></script>

<!-- Select2 Dropdowns -->
<script src="/assets/default/js/blog/select2.full.min.js" type="text/javascript"></script>

<!-- Cloudinary File Upload -->
<script src="/assets/default/js/blog/cloudinary/jquery.ui.widget.js" type="text/javascript"></script>
<script src="/assets/default/js/blog/cloudinary/jquery.iframe-transport.js" type="text/javascript"></script>
<script src="/assets/default/js/blog/cloudinary/jquery.fileupload.js" type="text/javascript"></script>
<script src="/assets/default/js/blog/cloudinary/cloudinary-jquery-file-upload.js" type="text/javascript"></script>
{{cloudinary_js_config()}}
<script src="/assets/default/js/blog/featured.upload.min.js" type="text/javascript"></script>

<!-- Featured Video -->
<script src="/assets/default/js/jsVideoUrlParser.min.js" type="text/javascript"></script>
<script src="/assets/default/js/blog/featuredvideo.min.js" type="text/javascript"></script>
{% endblock %}

