var DappurMedia=new function(){this.managerUrl=null,this.getFolderUrl=null,this.addFolderUrl=null,this.loadMedia=function(e){$("#media-modal-body").html(""),$("#media-modal").modal("show"),$("#media-modal-body").html('<iframe id="dappurmedia" width="100%" height="475px" frameborder="0" marginheight="0" marginwidth="0" src="'+this.managerUrl+'"></iframe>')},this.createFolder=function(e){var r=this.addFolderUrl;swal({title:"Create a New Folder",input:"text",showCancelButton:!0,confirmButtonText:"Submit",showLoaderOnConfirm:!0,preConfirm:function(a){return new Promise(function(t,i){DappurCSRF.csrfAjax(r,{current_folder:e,new_folder_name:a},function(e){if(parsed=jQuery.parseJSON(e),"error"==parsed.result){var r="";$.each(parsed.data,function(e,a){r=r+"<br />"+a}),i(r)}else"success"==parsed.result?t():i("An unknown error occured.")})})},allowOutsideClick:!1}).then(function(r){DappurMedia.getFolder(e+"/"+r),swal({type:"success",title:"New folder created successfully!",html:e+"/"+r})}).catch(swal.noop)},this.getFolder=function(e){$("#loader").show(),$("#folder_list").html(""),$("#file_list").html(""),DappurCSRF.csrfAjax(this.getFolderUrl,{directory:e},function(r){if(parsed=jQuery.parseJSON(r),$("#breadcrumb").html(""),$("#folder_list").html(""),$("#file_list").html(""),$("#breadcrumb").data("current",e),""==e)$("#breadcrumb").html("/ &nbsp;");else{$("#breadcrumb").html("/ &nbsp;");var a=e.split("/");$.each(a,function(e,r){""!=r&&$("#breadcrumb").append("<li>"+r+"</li>")})}""!=e?$("#back-button").show():$("#back-button").hide(),"error"==parsed.status&&swal("Oops...","You do not have permission to access that folder!","error"),$("#loader").hide(),$.each(parsed.folders,function(e,r){$("#folder_list").append('<div class="col-sm-2 col-xs-4 media-folder" data-folder="'+r+'" style="margin-bottom: 20px;"><div style="height: 100px; width: 100px; margin: 0 auto 0 auto;"><i class="fa fa-folder" style="font-size: 100px;"></i></div>'+r+"</div>")}),$.each(parsed.files,function(r,a){$.ajax({url:e+"/"+a,type:"HEAD",success:function(r,t,i){i.getResponseHeader("Content-Type").match("^image/")?$("#file_list").append('<div class="col-sm-2 col-xs-4 media-file" data-file="'+a+'" style="margin-bottom: 20px; height: 150px; word-break: break-all;"><img src="'+e+"/"+a+'" style="width: 100px; height: 100px; border-radius: 5px; margin-bottom: 5px;" /><br />'+a+"</div>"):$("#file_list").append('<div class="col-sm-2 col-xs-4 media-file" data-file="'+a+'" style="margin-bottom: 20px; height: 150px; word-break: break-all;"><div style="height: 100px; width: 100px; margin: 0 auto 5px auto;"><i class="fa fa-file" style="font-size: 100px;"></i></div>'+a+"</div>")}})})})},$("body").on("dblclick",".media-folder",function(){var e=$("#breadcrumb").data("current")+"/"+$(this).data("folder");DappurMedia.getFolder(e)}),$("body").on("click","#back-button",function(){var e=$("#breadcrumb").data("current").split("/");e.splice(-1,1),newFolder=e.join("/"),DappurMedia.getFolder(newFolder)}),$("body").on("click","#refresh-button",function(){var e=$("#breadcrumb").data("current");DappurMedia.getFolder(e)}),$("body").on("click","#new-folder-button",function(){var e=$("#breadcrumb").data("current");DappurMedia.createFolder(e)})};